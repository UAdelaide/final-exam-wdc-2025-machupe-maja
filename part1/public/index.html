<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Doggo of the Day</title>
  <link rel="stylesheet" href="stylesheets/style.css" />
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
  <main id="content">
    <h1>Dog of the Day</h1>
    <div id="doggoContainer">
      <button type="button" @click="showDoggoDeets = true">Doggo Deets</button>
      <div v-if="showDoggoDeets" id="doggo-deets">
        <img :src="picUrl" title="A picture of a husky" />
        <p>Name: {{ dogList[currDoggo].dog_name }}</p>
        <p>Size: {{ dogList[currDoggo].size }}</p>
        <p>Owner: {{ dogList[currDoggo].owner_username }}</p>
      </div>
      <p v-if="doggoErr" id="error">{{doggoErr}}</p>
      <div>
  </main>

  <script type="module">
    const {createApp} = Vue;

    createApp({
      data() {
        return {
          currDoggo: 0,
          dogList: [],
          doggoErr: "",
          showDoggoDeets: false
        }
      },
      computed: {
        picUrl() {
          if (this.dogList.length > 0) {
            console.dir(this.currDoggo);
            return this.dogList[this.currDoggo].picUrl;
          } else {
            return "";
          }
        }
      },
      methods: {
        async nextDoggo() {
          this.currDoggo = (this.currDoggo + 1) % dogList.length;
          this.showDoggoDeets = false;
        },
        async loadDogList() {
          // Fetch the list of dogs from our walking service
          const response = await fetch("/api/dogs", {
            method: "GET"
          });

          const results = await response.json();

          // Oh noooo
          if (!response.ok) {
            this.doggoErr = "Couldn't fetch the list of doggos. ";
            if (results.error) this.doggoErr += results.error;
          }

          // populate the dog list
          if (results && results.length > 0) {

            // Pre-load a pic for each dog 
            for (var i = 0; i < this.dogList.length; i++) {
              results[i].picUrl = await this.fetchDogPic();
            }

            this.dogList = results;
          }
        }
      },
      async fetchDogPic() {
        // Fetch!
        const response = await fetch("https://dog.ceo/api/breed/husky/images/random", {
          method: "GET"
        });

        const results = await response.json();

        // Oh noooo
        if (!response.ok) {
          this.doggoErr = "Couldn't fetch the doggo";
        }

        // Set the URL
        if (results && results.status === "success") {
          return results.message;
        }
      },
      mounted() {
        this.loadDogList().then();
      }
    }).mount("#content");
  </script>
</body>

</html>
